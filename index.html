<body>

<header>
  <div class="grad" aria-hidden></div>
  RealUniqueGemStones Catalog
</header>

<!-- Hidden file input kept for manual CSV load, but not shown visually -->
<input id="csvFile" type="file" accept=".csv" style="display:none" />

<div class="wrap">
  <div id="catalog" class="container" aria-live="polite"></div>
</div>

<script>
const catalogEl = document.getElementById('catalog');
const fileInput = document.getElementById('csvFile');

async function tryFetchCSV(){
  try{
    const r = await fetch('listings.csv', {cache:'no-store'});
    if(!r.ok) throw new Error('Fetch failed');
    const text = await r.text();
    parseCSVText(text);
  }catch{
    console.warn('Auto fetch failed. You can still use hidden file input.');
  }
}

function parseCSVText(text){
  const parsed = Papa.parse(text.trim(), {header:true, skipEmptyLines:true});
  renderCatalog(parsed.data || []);
}

function renderCatalog(data){
  catalogEl.innerHTML = '';
  data.forEach(item => {
    const title = item.TITLE || '';
    const price = item.PRICE || '';
    if(!title) return;
    const images = [];
    for(let i=1;i<=10;i++){
      const key='IMAGE'+i;
      if(item[key] && item[key].trim()) images.push(item[key].trim());
    }

    const card=document.createElement('div');
    card.className='card';
    const gallery=document.createElement('div');
    gallery.className='image-gallery';

    if(images.length){
      images.forEach((src,i)=>{
        const img=document.createElement('img');
        img.src=src; if(i===0) img.style.display='block';
        gallery.appendChild(img);
      });
      if(images.length>1){
        let cur=0;
        setInterval(()=>{
          const imgs=gallery.querySelectorAll('img');
          imgs.forEach((im,i)=>im.style.display=i===cur?'block':'none');
          cur=(cur+1)%imgs.length;
        },2500);
      }
    }

    const info=document.createElement('div');
    info.className='info';
    info.innerHTML=`<div class="title">${title}</div>
                    <div class="price">${(item.CURRENCY||'$')}${price}</div>`;

    card.appendChild(gallery);
    card.appendChild(info);
    catalogEl.appendChild(card);
  });
}

// fallback manual upload listener (kept functional but hidden)
fileInput.addEventListener('change', e=>{
  const f=e.target.files[0];
  if(!f) return;
  Papa.parse(f, {header:true, skipEmptyLines:true, complete:r=>renderCatalog(r.data)});
});

tryFetchCSV();
</script>
</body>
