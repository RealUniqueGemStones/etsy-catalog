<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Etsy Catalog Viewer</title>
<style>
  body {font-family:sans-serif;background:#fafafa;margin:0;padding:0;}
  .grid {display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:15px;padding:20px;}
  .card {background:white;border-radius:12px;box-shadow:0 2px 6px rgba(0,0,0,0.1);
         overflow:hidden;cursor:pointer;transition:transform .2s;}
  .card:hover {transform:scale(1.03);}
  .card img {width:100%;height:200px;object-fit:cover;}
  .title {padding:10px;font-weight:bold;}
  /* popup */
  .popup {position:fixed;top:0;left:0;width:100%;height:100%;
          background:rgba(0,0,0,0.7);display:none;justify-content:center;align-items:center;}
  .popup-content {background:white;border-radius:10px;max-width:900px;width:90%;display:flex;gap:20px;padding:20px;position:relative;}
  .popup img {max-width:100%;max-height:500px;object-fit:contain;border-radius:8px;}
  .info {flex:1;}
  .close {position:absolute;top:10px;right:15px;font-size:20px;cursor:pointer;}
  .btns {margin-top:10px;}
  button {padding:6px 12px;margin:5px;border:none;background:#333;color:white;border-radius:6px;cursor:pointer;}
  button:hover {background:#555;}
</style>
</head>
<body>
<div class="grid" id="catalog"></div>

<div class="popup" id="popup">
  <div class="popup-content">
    <span class="close" id="close">&times;</span>
    <div class="image-side">
      <img id="product-image" src="" alt="">
      <div class="btns">
        <button id="prevImg">Prev</button>
        <button id="nextImg">Next</button>
      </div>
    </div>
    <div class="info">
      <h2 id="product-title"></h2>
      <p id="product-price"></p>
      <p id="product-quantity"></p>
    </div>
  </div>
</div>

<script>
async function loadCSV() {
  const res = await fetch('listings.csv');
  const text = await res.text();
  const rows = text.split(/\r?\n/).filter(r => r.trim() !== "");
  const headers = rows[0].split(',');
  const products = rows.slice(1).map(r => {
    const cols = r.split(',');
    let obj = {};
    headers.forEach((h,i)=>obj[h.trim()] = cols[i] ? cols[i].trim() : "");
    return obj;
  });
  return products;
}

loadCSV().then(products=>{
  const catalog=document.getElementById('catalog');
  products.forEach((p,i)=>{
    const card=document.createElement('div');
    card.className='card';
    const img=p.IMAGE1 || p.IMAGE2 || '';
    card.innerHTML=`<img src="${img}" alt=""><div class="title">${p.TITLE}</div>`;
    card.onclick=()=>openPopup(p);
    catalog.appendChild(card);
  });
});

let currentImages=[], currentIndex=0;

function openPopup(p){
  currentImages=[];
  for(let i=1;i<=10;i++){
    if(p[`IMAGE${i}`]) currentImages.push(p[`IMAGE${i}`]);
  }
  currentIndex=0;
  document.getElementById('product-image').src=currentImages[0]||'';
  document.getElementById('product-title').textContent=p.TITLE;
  document.getElementById('product-price').textContent='Price: '+p.PRICE+' '+(p.CURRENCY||'');
  document.getElementById('product-quantity').textContent='Quantity: '+p.QUANTITY;
  document.getElementById('popup').style.display='flex';
}

document.getElementById('close').onclick=()=>document.getElementById('popup').style.display='none';
document.getElementById('nextImg').onclick=()=>changeImg(1);
document.getElementById('prevImg').onclick=()=>changeImg(-1);

function changeImg(dir){
  if(currentImages.length===0) return;
  currentIndex=(currentIndex+dir+currentImages.length)%currentImages.length;
  document.getElementById('product-image').src=currentImages[currentIndex];
}
</script>
</body>
</html>
